jQuery(function(){$("body").hasClass("as_embed")&&!$("body").hasClass("no-args")&&$(window).on("touchmove scroll",function(e){e.preventDefault(),window.scrollTo(0,0)}),loadForm(),setFormHandlers()});var formValidateEmail=function(e){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e&&""!=e.trim()?t.test(e):!1},formInputFloatLabel=function(){var e=jQuery,t=this,i=e(t).attr("placeholder")?e(t).attr("placeholder"):!1,i=e(t).attr("data-label")?e(t).attr("data-label"):i,a=(e(t).attr("type"),e(t).val());return i?a.length<=0?(e(t).hasClass("float-label")&&e(t).removeClass("float-label"),e(t).siblings(".float-label-text").remove(),!0):e(t).hasClass("float-label")?!0:(e('<label class="float-label-text">'+i+"</label>").insertBefore(t),void e(t).addClass("float-label")):!0},formData={nextText:"Next",submitText:"Sign up",errorText:"Oops!",nextIcon:'<i class="ion-arrow-right-c"></i>',submitIcon:'<i class="ion-android-drafts"></i>',errorIcon:'<i class="ion-android-sad"></i>',loadingIcon:'<i class="ion-more"></i>',translate:{french:{next:"Prochain",submit:"S'inscrire"},spanish:{next:"Siguiente",submit:"RegÃ­strate"}}},nextField=function(e){var t=jQuery,i=t(".multi-field.current"),a=t(i).next(".multi-field").length>0,l=t(i).next(".multi-field");t(l).next(".multi-field").length<=0;return e&&e.preventDefault(),a?(t(i).removeClass("current"),t(i).addClass("previous"),t(l).addClass("current"),t(l).addClass("seen"),t(l).hasClass("seen")||t(l).addClass("seen"),!1):!1},nextInvalidField=function(e){var t=jQuery,i=t("#list_signup"),a=t(i).find(".multi-field > input"),l=t(i).find(".multi-field").length,n=t(i).find(".multi-field").not(".seen").length,s=t(i).find(".multi-field.current"),r=t(i).find(".multi-field.previous"),o=!1;return e&&e.preventDefault(),t.each(a,function(e){var i=t(this),a=t(i).val(),l=t(i).parent();return o!==!1?!1:("email"!=t(i).attr("id")||a.length||(o=l),o||"email"!=t(i).attr("type")||formValidateEmail(a)||(o=l),t(o).addClass("invalid"),void t(o).find("input").on("keydown",function(){t(o).removeClass("invalid")}))}),!o&&l>1&&n>0&&(o=t(s).next(".multi-field").not(".seen")),o?t(o).hasClass("current")?!0:(t(r).removeClass("previous"),t(s).addClass("previous"),t(s).removeClass("current"),t(o).addClass("current"),t(o).addClass("seen"),t(o).find("input").focus(),t(o).hasClass("last-multi-field")&&(t(i).find("#submit > .text").text(formData.submitText),t(i).find("#submit > .icon").html(formData.submitIcon)),!0):!1},prevField=function(e){var t=jQuery,i=t(".multi-field.current"),a=t(i).prev(".multi-field"),l=t(a).length>0;return e&&e.preventDefault(),l?(t(i).removeClass("current"),t(i).addClass("previous"),t(".multi-field.previous").removeClass("previous"),t(a).addClass("current"),t(a).find("input").focus(),t(a).hasClass("seen")||t(a).addClass("seen"),!1):!1},goToField=function(e){var t=jQuery,i=t("#list_signup"),a=t(i).find(".multi-field.current"),l=t(i).find(".multi-field.previous"),n=t(i).find(".multi-field"+e);return t(l).removeClass("previous"),t(a).addClass("previous"),t(a).removeClass("current"),t(n).addClass("current"),t(n).addClass("seen"),t(n).find("input").focus(),!0},setFormHandlers=function(){var e=jQuery,t=e("#list_signup");e(".list-page-title").unbind("flowtype"),e(".list-page-title").flowtype({maximum:725,minFont:14,maxFont:27,fontRatio:18}),e(t).find("#submit").unbind("click"),e(t).find("#submit").click(saveSubscriber),e(t).find(".multi-field > input").unbind("focus"),e(t).find(".multi-field > input").focus(function(t){return e(this).parent().hasClass("current")?!0:void e(".multi-field.current > input").focus()}),e(t).find(".multi-field > input").unbind("keydown"),e(t).find(".multi-field > input").keydown(function(e){var t=e.keyCode||e.which;13===t&&saveSubscriber(),38===t&&resetFields()}),e(t).unbind("submit"),e(t).submit(function(){return!1}),new Clipboard(".form-link-click")},resetFields=function(){var e=$("#list_signup"),t=formData.submitText,i=formData.submitIcon;$(e).find("input").each(function(){$(this).prop("disabled",!1)}),$(e).find(".seen").removeClass("seen"),$(".multi-field").length>1&&(t=formData.nextText,i=formData.nextIcon),$(e).find("#submit > .text").show(),$(e).find("#submit > .icon").hide(),$(e).find("#submit > .text").text(t),$(e).find("#submit > .icon").html(i),goToField("#email_holder")},saveSubscriber=function(){var e=jQuery,t=e("#list_signup"),i=e(t).find("#email").val(),a=e(t).find("#submit > .text"),l=e(t).find("#submit > .icon"),n="Oops! Please try again.",s={action:"add_list_signup",post_id:e(t).find("#form").val()||"",signup_id:e(t).find("#signup").val()||"",email:i,first_name:e(t).find("#first_name").val()||"",last_name:e(t).find("#last_name").val()||"",source:window.location.href};return"undefined"!=typeof refData&&(s.referrer=refData.referrer),nextInvalidField()?!1:formValidateEmail(i)?(e(a).hide(),e(a).text(formData.loadingText),e(l).html(formData.loadingIcon),e(l).show(),e.ajax({type:"POST",url:"undefined"==typeof ajaxUrl?"/wp-admin/admin-ajax.php":ajaxUrl,data:s,success:function(i){if(i=e.parseJSON(i),i&&"1"==i.success){var s=i.signupId||"";return"function"==typeof ga&&ga("send","event","Forms","New Subscriber",s,"1"),e("#signup").val(s),e(".kabuki").fadeOut(300,function(){e(t).hide(),e(".list-desc").hide(),e(".list-page-title").text(e(".list-page-title").attr("data-confirmation")),e(".list-share").show(),e(".kabuki").fadeIn(300)}),!0}e(l).hide(),e(a).show(),i.message&&(n=i.message),alertMsgForm(n)},error:function(e){console.log("error"),console.log(e)}}),!1):!1},alertMsgForm=function(e){var t=$("#list_signup"),i=$(t).find("#submit > .text"),a=$(t).find("#submit > .icon"),l=$(t).find(".multi-field.current");$(l).removeClass("current"),$('<div class="multi-field current invalid alert-message-field"><input class="form-control" style="color: red;" type="text" disabled="disabled" value="'+e+'"/></div>').insertAfter($(l)),setTimeout(function(){$(".alert-message-field").remove(),resetFields()},1e3),$(i).text(formData.errorText),$(a).html(formData.errorIcon)},loadForm=function(){var e,t,i,a,l=jQuery,n=(l("#list_signup"),"undefined"==typeof window.formSlug?!1:formSlug);return!n&&l("body").hasClass("page-template-template-dash")&&l(".list-page").length&&l(".list-page").attr("id")&&(n=l(".list-page").attr("id").replace("view_","")),n?void l.ajax({type:"POST",url:"undefined"==typeof ajaxUrl?"/wp-admin/admin-ajax.php":ajaxUrl,data:{action:"up_get_form_data",slug:n},success:function(n){return n=l.parseJSON(n),1!=n.success?!1:(e=1==n.isPremiumAuthor,t=1==n.showAdditionalFields,i=1==n.showFirstNameField,a=1==n.showLastNameField,e?l(".powered-by").remove():l(".powered-by").attr("style",""),e?showAdditionalFields({all:t,firstName:i,lastName:a}):(l(".kabuki").show(),l(".list-page-title").unbind("flowtype"),l(".list-page-title").flowtype({maximum:725,minFont:14,maxFont:27,fontRatio:18})),void(e&&n.prefillForm&&prefillForm(n.prefillForm)))}}):!1},showAdditionalFields=function(e){var t=jQuery,i=t("#list_signup"),a=e.all||!1,l=e.firstName||!1,n=e.lastName||!1,s=formData.submitText,r=formData.submitIcon;(l!==!1||a!==!1)&&(t(i).find("#first_name_holder").addClass("multi-field"),t(i).find("#first_name_holder").show(),t(i).find("#first_name_holder").addClass("last-multi-field"),s=formData.nextText,r=formData.nextIcon),l||t(i).find("#first_name_holder").remove(),(n!==!1||a!==!1)&&(t(i).find("#last_name_holder").addClass("last-multi-field"),t(i).find("#last_name_holder").addClass("multi-field").show(),t(i).find("#last_name_holder").show(),t(i).find(".last-multi-field").removeClass("last-multi-field"),t(i).find("#last_name_holder").addClass("last-multi-field")),n||t(i).find("#last_name_holder").remove(),t(i).find("#submit > .text").text(s),t(i).find("#submit > .icon").html(r),t(".kabuki").show(),t(".list-page-title").unbind("flowtype"),t(".list-page-title").flowtype({maximum:725,minFont:14,maxFont:27,fontRatio:18}),setFormHandlers()},prefillForm=function(e){var t=jQuery,i=t("#list_signup"),a=e.email||!1,l=e.first_name||!1,n=e.last_name||!1;return a&&!t("#email").is(":focus")&&t(i).find("#email").val(a),l&&!t("#first_name").is(":focus")&&t(i).find("#first_name").val(l),n&&!t("#last_name").is(":focus")&&t(i).find("#last_name").val(n),t(".form-control").each(formInputFloatLabel),!0};